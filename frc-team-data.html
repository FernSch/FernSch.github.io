<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>frc team data</title>
    <link rel="stylesheet" href="style.css">
  
<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
<script defer src="https://pyscript.net/latest/pyscript.js"></script>
    
  </head>
  <body>
	<script src="index.js"></script>
	  <center>
  <h1 style="color: white;">FRC Team Data Card Generator</h1>
		  <h2 style="color: white;">Generate a Data card for an FRC team, based on statbotics</h2>
	  <center>
		  <form onsubmit="runPythonScript()">
		  <input type="number" min=1 max=9999>
			  <input type="submit" value="Submit" label="team number">
			  <form>
				  
	<script>
		
		function runPythonScript()
		{
			
			const exp = pyodideGlobals.get('save_image');
		}
		
				  </script>
				  
				  
				  <py-script>
import statbotics
from PIL import Image, ImageFont, ImageDraw
import random
from datetime import datetime

def save_image():
	#enter team num
	team_num = 2056

	year = datetime.now().strftime("%Y")
	white = (255,255,255)
	black = (0,0,0)
	img = Image.open("Asset 3.png")
	title_font = ImageFont.truetype('Europa Regular.ttf', 50)
	small_font = ImageFont.truetype('Europa Regular.ttf', 25)


	sb = statbotics.Statbotics()
	try:
	  data = sb.get_team(team_num)
	except: 
	  print("invalid team num")

	name = data['name']
	image_editable = ImageDraw.Draw(img)
	image_editable.text((60, 35), name, white, font=title_font)
	team_data = sb.get_team_year(team_num, int(year))
	current_epa = team_data['epa_mean']
	country_epa_rank = team_data['country_epa_rank']
	win = team_data['winrate']


	th = ["4","5","6","7","8","9","0"]
	st = ["1"]
	nd = ["2"]
	rd = ["3"]
	if str(country_epa_rank)[-1] in th:
	  country_epa_rank = str(country_epa_rank) + "th"
	elif str(country_epa_rank)[-1] in st:
	  country_epa_rank = str(country_epa_rank) + "st"
	elif str(country_epa_rank)[-1] in nd:
	  country_epa_rank = str(country_epa_rank) + "nd"
	elif str(country_epa_rank)[-1] in rd:
	  country_epa_rank = str(country_epa_rank) + "rd"



	image_editable.text((50,225), str(current_epa), black, font=small_font)

	image_editable.text((50,365), str(country_epa_rank), black, font=small_font)

	image_editable.text((50,520), str(win * 100) + "%", black, font=small_font)


	img.save(f"{team_num}_data.png")
	#print("done")
	  
					  
					  
					  
				  </py-script>
  </body>
</html>
