<!DOCTYPE html>
<html>
  <head>
    <title>FRC Team Data Card Generator</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>FRC Team Data Card Generator</h1>
    <h2>Generate a Data card for an FRC team, based on Statbotics</h2>
    <form>
      <label for="team_num_data">Team Number:</label>
      <input type="text" id="team_num_data" name="team_num_data"><br><br>
      <input type="submit" value="Submit">
    </form>
    <div id="team-data-card"></div>
    <script>
      const teamNumData = document.getElementById('team_num_data');
      const teamDataCard = document.getElementById('team-data-card');

      const urlParams = new URLSearchParams(window.location.search);
      const teamNum = urlParams.get('team');
      if (teamNum) {
        teamNumData.value = teamNum;
        getTeamData(teamNum);
      }

      function getTeamData(team) {
        fetch(`https://api.statbotics.io/v2/team/${team}`)
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              teamDataCard.innerText = data.error;
              return;
            }
            const { name, country, rookie_year, winrate } = data.team;
            const fullWinrate = `${(winrate * 100).toFixed(2)}%`;
            const img = generateTeamCard(name, team, country, rookie_year, fullWinrate);
            teamDataCard.innerHTML = '';
            teamDataCard.appendChild(img);
          })
          .catch(error => {
            teamDataCard.innerText = `Error: ${error.message}`;
          });
      }

      function generateTeamCard(name, team, country, rookie_year, fullWinrate) {
        const canvas = document.createElement('canvas');
        canvas.width = 900;
        canvas.height = 300;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#FFF';
        ctx.font = 'bold 70px Arial';
        ctx.fillText(`${name} ${team}`, 50, 100);
        ctx.font = '30px Arial';
        ctx.fillText(`Country: ${country}`, 50, 200);
        ctx.fillText(`Rookie Year: ${rookie_year}`, 50, 240);
        ctx.fillText(`Full Winrate: ${fullWinrate}`, 50, 280);
        const img = document.createElement('img');
        img.src = canvas.toDataURL();
        img.alt = `${name} ${team}`;
        return img;
      }

      const form = document.querySelector('form');
      form.addEventListener('submit', event => {
        event.preventDefault();
        const team = teamNumData.value;
        const params = new URLSearchParams({ team });
        history.pushState(null, '', `?${params.toString()}`);
        getTeamData(team);
      });
    </script>
  </body>
</html>
